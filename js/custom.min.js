var mywrapper = document.querySelector('.words-wrapper')
//var body = document.querySelector('body');
var view = document.querySelector('.view');
var endturn = document.querySelector('.fin_de_tour');
//mywrapper.classList = 'words-wrapper';
//body.appendChild(mywrapper);
//var team = " ";
//var blueteam = " ";
var redteamwordsremaning = document.querySelector('[name="redwordsremaning"]').value;
var blueteamwordsremaning = document.querySelector('[name="bluewordsremaning"]').value;
var blackword = false;
//var wordteamarray = []

//function addToDataBase() {
//    let myarrayofdata = [];
//    let data = document.querySelectorAll('.a-word')
//    for (let i = 0; i < data.length; i++) {
//        //        myarrayofdata.push(data[i].)
//        let myarraytemp = [];
//        myarraytemp.push(data[i].getAttribute("data-grid_place"));
//        myarraytemp.push(data[i].getAttribute("data-team"));
//        myarraytemp.push(data[i].textContent);
//        myarrayofdata.push(myarraytemp);
//        /** REMOVE QUAND TOUR JOUEUR 2 **/ 
//        //data[i].removeAttribute("data-team");
//    }
//    $.get('savegrid.php', {
//        mydata: myarrayofdata
//    }).done(function (data) {
//        console.log('HELLO')
//    });
//}

function inializeTeam() {
    if ((Random(0, 2)) == 0) {
        team = "blue";
        blueteam = "red";
    } else {
        team = "red";
        blueteam = "blue";
    }
}

//function selectAndRemoveWord(arrayofwords) {
//    var randomWord = Random(0, (arrayofwords.length));
//    var wordtoRemove = arrayofwords[randomWord]
//    arrayofwords.splice(randomWord, 1);
//    return wordtoRemove;
//}
/*function wordsAttribution(teamoption, numberofwords, arrayofwords){
    for (let i = 0 ; i<numberofwords ; i++){
        let Randomword = Random(0, arrayofwords.length);
        arrayofwords[Randomword].setAttribute('data-team', teamoption)       arrayofwords.splice(Randomword, 1);
    }
}*/
//function inializeGridOfWords(listofwords) {
//    for (var i = 1; i <= 5; i++) {
//        for (var j = 1; j <= 5; j++) {
//            var myword = document.createElement('div');
//            myword.className = 'a-word';
//            myword.setAttribute('data-grid_place', (i + 'x' + j));
//            myword.textContent = selectAndRemoveWord(listofwords);
//            mywrapper.appendChild(myword);
//
//        }
//    }
//    let mywordstoattribute = document.querySelectorAll('.a-word');
//    mywordstoattribute = Array.from(mywordstoattribute);
//    console.log(typeof mywordstoattribute);
//    //console.log(mywordstoattribute);
//    for (let i = 0; i < 8; i++) { //On insère les mots TEAM
//        let Randomword = Random(0, mywordstoattribute.length);
//        mywordstoattribute[Randomword].setAttribute('data-team', 'team')
//        mywordstoattribute.splice(Randomword, 1);
//    }
//    for (let i = 0; i < 7; i++) { //On insère les mots TEAM
//        let Randomword = Random(0, mywordstoattribute.length);
//        mywordstoattribute[Randomword].setAttribute('data-team', 'blueteam')
//        mywordstoattribute.splice(Randomword, 1);
//    }
//    for (let i = 0; i < 9; i++) { //On insère les mots TEAM
//        let Randomword = Random(0, mywordstoattribute.length);
//        mywordstoattribute[Randomword].setAttribute('data-team', 'neutral')
//        mywordstoattribute.splice(Randomword, 1);
//    }
//    mywordstoattribute[0].setAttribute('data-team', 'blackword');
//}

function Random(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

function gamefinished() {
    if (blueteamwordsremaning <= 0 || redteamwordsremaning <= 0 || blackword == true) {
        return true;
    } else {
        return false;
    }
}


/****************************************
 *********CLICK SUR UN MOT****************
 *****************************************/
var mywordclickedplace = "dd";
mywrapper.addEventListener("click", function (e) {
    wordclickedplace = e.target.getAttribute("data-grid_place");
    mywordclickedplace = e.target.getAttribute("data-grid_place");
    console.log(mywordclickedplace);
    $.get('updatePDO.php', {
        mywordclickedplace: wordclickedplace
    }).done(function (data) {

        let wordclickedteam = data.team;
        console.log(wordclickedteam);
        //        e.target.setAttribute("data-team", wordclickedteam);
        //        if (wordclickedteam == "team") {
        //            //console.log("BIEN JOUÉ !!");
        //            redteamwordsremaning--;
        //        } else if (wordclickedteam == "blueteam") {
        //            //console.log("AIE !!");
        //            blueteamwordsremaning--;
        //        } else if (wordclickedteam == "blackword") {
        //            //console.log('MOT BLACK')
        //            blackword = true;
        //        }
        //        e.target.classList.add('found');
        if (gamefinished()) {
            document.querySelector('.wrapper').classList.add('active');
        }
    });


    //console.log(e.target);


});
view.addEventListener("click", function () {
    /** QUAND TOUR JOUEUR1 - DONNEE ACCES AUX MOTS EN AJOUTANT DATA-ATTRIBUTE**/
    let arrayofwords = document.querySelectorAll('.a-word');
    //console.log(arrayofwords);
    for (let i = 0; i < arrayofwords.length; i++) {
        arrayofwords[i].classList.toggle('temp');
    }
});


endturn.addEventListener("click", function () {
    $.get('changeturnPDO.php', {
    }).done(function (data) {
        
    });
});


var evtSource = new EventSource("editPDO.php");
evtSource.addEventListener("ping", function (e) {
    var data = JSON.parse(e.data);
    //console.log(data.place);
    var thewordclicked = document.querySelector('[data-grid_place="' + data.place + '"]');
    console.log(thewordclicked);
    let wordclickedteam = data.team;
    //console.log(wordclickedteam);
    thewordclicked.setAttribute("data-team", wordclickedteam);
    if (wordclickedteam == "team") {
        //console.log("BIEN JOUÉ !!");
        redteamwordsremaning--;
    } else if (wordclickedteam == "blueteam") {
        //console.log("AIE !!");
        blueteamwordsremaning--;
    } else if (wordclickedteam == "blackword") {
        //console.log('MOT BLACK')
        blackword = true;
    }
    thewordclicked.classList.add('found');
    

}, false);
